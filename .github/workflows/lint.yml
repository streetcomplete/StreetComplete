name: "Lint"
on:
  push:
    branches:
      - master
  pull_request:

jobs:
  ktlint:
    name: "Kotlin"
    runs-on: ubuntu-latest
    env:
      lintResultFilename: ktlint-result.txt
      prCommentHeader: ktlint-message
    steps:
      - name: Checkout the source code
        uses: actions/checkout@v2
      - name: Run Kotlin linter
        id: ktlint-check
        uses: musichin/ktlint-check@v1
        with:
          version: '0.43.2'
          reporter: plain?group_by_file,output=${{ env.lintResultFilename }}
          relative: true
          verbose: true
        continue-on-error: true
      - name: Kotlin linter result
        run: |
          cat ${{ env.lintResultFilename }}
          [ "${{ steps.ktlint-check.outcome }}" == "success" ] || exit 1
      - if: ${{ github.event_name == 'pull_request' && failure() }}
        name: Comment on PR
        uses: marocchino/sticky-pull-request-comment@v2.2.0
        with:
          header: ${{ env.prCommentHeader }}
          recreate: true
          path: .github/ktlint-message.md
      - if: ${{ github.event_name == 'pull_request' && success() }}
        name: Delete comment
        uses: marocchino/sticky-pull-request-comment@v2.2.0
        with:
          header: ${{ env.prCommentHeader }}
          delete: true
